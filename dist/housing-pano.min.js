!function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){(function(){var t,e;e=void 0,t=void 0,DirectPano.show_pano=function(){e=o(1),e.Annotation=new e.annotation(DirectPano.annotation_angles),e.Annotation.add_annotations(0),e.Annotation.update(),e.scene.children.length=0,t=new e.animation,e.add_listeners(),e.Hotspot=new e.hotspot(DirectPano.hotspots_angle),e.Transition=new e.transition(DirectPano.pano_path,DirectPano.hotspots_angle),e.Hotspot.add_hotspots(0),e.Hotspot.update()},DirectPano.remove_pano=function(){t.destroy=!0,t=null,e.remove_listeners(),e.Hotspot.destroy_hotspot(),e.Hotspot=null,e.Transition.destroy_transition(),e.Transition=null,e.Annotation.destroy_annotation(),e.Annotation=null,e.destroy()}}).call(this)},function(t,e,o){(function(){var e,n,i,a,s,r,l,p,h,c,d,u,m,_,f,g;f=o(2),r=void 0,l=void 0,s=void 0,a=void 0,n=7,i=2,g=function(t){var e,o,n,i;switch(n=t.changedTouches,e=n[0],i="",t.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}o=document.createEvent("MouseEvent"),o.initMouseEvent(i,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(o),t.preventDefault()},c=function(t){var e,o,n;t.preventDefault(),f.Config.isUserInteracting=!0,r=t.clientX,l=t.clientY,s=f.Config.lon,a=f.Config.lat,n=new THREE.Vector3,e=document.getElementById("container"),n.set(t.clientX/e.offsetWidth*2-1,2*-(t.clientY/e.offsetHeight)+1,.5),n.unproject(f.camera),f.raycaster.set(f.camera.position,n.sub(f.camera.position).normalize()),o=f.raycaster.intersectObjects(f.scene.children,!0),o.length>0&&"hotspot"===o[0].object.name&&f.Transition.start(o[0].object.hotspot_id)},d=function(t){var e;f.Config.isUserInteracting===!0&&(e=.3,f.Config.lon=(r-t.clientX)*e+s,f.Config.lat=(t.clientY-l)*e+a)},u=function(t){f.Config.isUserInteracting=!1,f.Config.stop_time=Date.now(),f.Config.autoplay=!1},m=function(t){t.wheelDeltaY?f.camera.fov-=.05*t.wheelDeltaY:t.wheelDelta?f.camera.fov-=.05*t.wheelDelta:t.detail&&(f.camera.fov+=1*t.detail),f.camera.fov=Math.max(60,Math.min(90,f.camera.fov)),f.camera.updateProjectionMatrix()},p=function(t){var e,o,a;a=void 0,t||(t=window.event),f.Config.isUserInteracting=!0,o=t.keyCode,37===o?f.Config.lon-=i:39===o?f.Config.lon+=i:38===o?f.Transition.moving===!1&&(a=f.Hotspot.front_nearest_hotspot(f.Transition.current_pano),-1!==a&&f.Transition.start(a)):40===o?f.Transition.moving===!1&&(a=f.Hotspot.back_nearest_hotspot(f.Transition.current_pano),-1!==a&&f.Transition.start(a)):27===o&&(e=document.getElementById(DirectPano.pano_div_id),e.style.width===window.innerWidth+"px"&&(e.style.height=window.innerHeight+"px")&&f.escape_fullscreen()),f.Config.isUserInteracting===!0&&n>i&&(i+=1)},h=function(t){f.Config.isUserInteracting=!1,i=2,f.Config.stop_time=Date.now(),f.Config.autoplay=!1},e=function(){return $("#"+DirectPano.pano_div_id).on({click:function(t){$("#"+DirectPano.pano_div_id).focus()},mousedown:function(t){c(t)},mousemove:function(t){d(t)},mouseup:function(t){u(t)},mousewheel:function(t){m(t.originalEvent)},DOMMouseScroll:function(t){m(t.originalEvent)},touchstart:function(t){g(t.originalEvent)},touchmove:function(t){g(t.originalEvent)},touchend:function(t){g(t.originalEvent)},keydown:function(t){p(t)},keyup:function(t){h(t)}})},_=function(){$("#"+DirectPano.pano_div_id).off()},f.add_listeners=e,f.remove_listeners=_,t.exports=f}).call(this)},function(t,e,o){(function(){var e,n;e=o(3),n=function(){function t(t,o){this.path=t,this.current_pano=0,this.moving=!1,this.hotspot_angles=o,this.destroy=!1,e.clear_images={},e.blur_images={},e.clear_images[this.current_pano]=[],t=t+(this.current_pano+1)+"/mobile_",this.blur_pano=new e.Pano(0,!0),this.clear_pano=new e.Pano(0,!1),this.blur_pano.create_pano(t,0),this.clear_pano.create_pano(t,1),this.preload_images()}return t.prototype.save_clear_images=function(){var t,o,n;if(t=this.current_pano,n=this.path,!e.clear_images[t])for(n=n+(t+1)+"/mobile_",e.clear_images[t]=[],o=0;6>o;)!function(){var i,a,s;s=new THREE.Texture(e.texture_placeholder),a=o,i=new Image,i.onload=function(){i.onload=null,s.image=this,s.needsUpdate=!0,e.clear_images[t][a]=i},i.src=n+e.Config.img_name[o]+".jpg"}(),o++},t.prototype.preload_images=function(){var t,o,n,i;for(n=0,t=this.current_pano,o=this.hotspot_angles,i=this.path;n<o[t].length;)!function(){var a,s,r;if(r=o[t][n][0],!e.blur_images[r])for(e.blur_images[r]=[],a=i+"blur_"+(r+1)+"/mobile_",s=0;6>s;)!function(){var t,o,n;n=new THREE.Texture(e.texture_placeholder),o=s,t=new Image,t.onload=function(){t.onload=null,n.image=this,n.needsUpdate=!0,e.blur_images[r][o]=t},t.src=a+e.Config.img_name[s]+".jpg"}(),s++}(),n++},t.prototype.start=function(t){var o,n,i,a,s,r;o=this.current_pano,s=this.hotspot_angles[o][t][0],i=this.hotspot_angles[o][t][1],n=this.hotspot_angles[o][t][2],this.moving=!0,this.current_pano=s,this.save_clear_images(),r=this.find_rotation_angle(i),e.Hotspot.remove_hotspots(),e.Annotation.remove_annotations(),a=this.old_pano_to_blur_pano.bind(this),this.preload_images(),this.load_blur_pano(n,i).done(function(){a(n,i,r)})},t.prototype.find_rotation_angle=function(t){var o;for(o=t-e.Config.lon;o>180;)o-=360;for(;-180>o;)o+=360;return o>50?o=(o-180)%360:-50>o&&(o=(o+180)%360),o+=e.Config.lon},t.prototype.load_blur_pano=function(t,o){var n,i,a;if(this.destroy)return $.when().done(function(){}).promise();for(a=this.path+"blur_"+(this.current_pano+1)+"/mobile_",n=[],i=0;6>i;)n[i]=$.Deferred(),i++;for(this.blur_pano.pano_id=this.current_pano,i=0;6>i;)this.blur_pano.mesh.material.materials[i].map.dispose(),this.blur_pano.mesh.material.materials[i].map=this.blur_pano.get_texture(this.pano_id,a+e.Config.img_name[i]+".jpg",n[i],i),this.blur_pano.mesh.material.materials[i].opacity=0,i++;return this.blur_pano.mesh.position.x=t*Math.cos(THREE.Math.degToRad(o)),this.blur_pano.mesh.position.z=t*Math.sin(THREE.Math.degToRad(o)),$.when.apply($,n).done(function(){}).promise()},t.prototype.load_clear_pano=function(){var t,o,n;if(this.destroy)return $.when().done(function(){}).promise();for(n=this.path+(this.current_pano+1)+"/mobile_",t=[],o=0;6>o;)t[o]=$.Deferred(),o++;for(this.clear_pano.pano_id=this.current_pano,o=0;6>o;)this.clear_pano.mesh.material.materials[o].map.dispose(),this.clear_pano.mesh.material.materials[o].map=this.clear_pano.get_texture(this.pano_id,n+e.Config.img_name[o]+".jpg",t[o],o),this.clear_pano.mesh.material.materials[o].opacity=0,o++;return $.when.apply($,t).done(function(){}).promise()},t.prototype.old_pano_to_blur_pano=function(t,o,n){var i,a,s,r,l,p;if(!this.destroy){for(p=.4,TweenLite.to(e.Config,p,{lon:n,lat:0,ease:Power0.easeOut}),l=2,s=.3,i=this.blur_pano,a=this.clear_pano,TweenLite.to(i.mesh.position,l,{x:0,z:0,delay:s,ease:Expo.easeOut}),r=0;6>r;)TweenLite.to(a.mesh.material.materials[r],l,{opacity:0,delay:s,ease:Expo.easeOut}),TweenLite.to(i.mesh.material.materials[r],l,{opacity:1,delay:s,ease:Expo.easeOut}),r++;TweenLite.to(a.mesh.position,l,{x:-1*t*Math.cos(THREE.Math.degToRad(o)),z:-1*t*Math.sin(THREE.Math.degToRad(o)),delay:s,ease:Expo.easeOut,onComplete:this.check_new_pano_load.bind(this)})}},t.prototype.check_new_pano_load=function(){var t,e;if(!this.destroy){for(this.clear_pano.mesh.position.x=0,this.clear_pano.mesh.position.z=0,e=0;6>e;)this.clear_pano.mesh.material.materials[e].opacity=0,this.clear_pano.mesh.material.materials[e].map.dispose(),this.blur_pano.mesh.material.materials[e].opacity=1,e++;t=this.blur_pano_to_new_pano.bind(this),this.load_clear_pano().done(function(){t()})}},t.prototype.blur_pano_to_new_pano=function(){var t,e,o,n;if(!this.destroy){for(t=this.blur_pano,e=this.clear_pano,n=.5,o=0;6>o;)TweenLite.to(t.mesh.material.materials[o],n,{opacity:0,ease:Power0.easeOut}),o++;for(o=0;6>o;)5===o?TweenLite.to(e.mesh.material.materials[o],n,{opacity:1,ease:Power0.easeOut,onComplete:this.complete.bind(this)}):TweenLite.to(e.mesh.material.materials[o],n,{opacity:1,ease:Power0.easeOut}),o++}},t.prototype.alter_moving=function(){return this.moving=!1},t.prototype.complete=function(){var t,o;this.destroy||(o=this.current_pano,t=this.alter_moving.bind(this),e.Hotspot.add_hotspots(o).done(function(){e.Annotation.add_annotations(o),t()}))},t.prototype.destroy_transition=function(){var t,e;this.destroy=!0,t=this.blur_pano,e=this.clear_pano,TweenLite.killTweensOf(t),TweenLite.killTweensOf(e),this.blur_pano.destroy_pano(),this.clear_pano.destroy_pano(),this.blur_pano=null,this.clear_pano=null},t}(),e.transition=n,t.exports=e}).call(this)},function(t,e,o){(function(){var e,n,i;i=o(4),n=void 0,e=function(){function t(t,e){this.annotation_angles=t,this.content=e,this.panoid=void 0,this.length=0,this.destroy=!1}return t.prototype.add_annotation=function(t){var e;t="annotation_"+t,e=$("<div></div>",{id:t}),e.prepend('<img src="../test/images/i-image.png" width=30 height=30/>'),e.width(30).height(30),$("#"+DirectPano.pano_div_id).append(e)},t.prototype.add_annotations=function(t){var e;this.panoid=t;try{for(this.length=this.annotation_angles[t].length,e=0;e<this.length;){if(this.destroy)return void this.remove_annotations();this.add_annotation(e),e++}}catch(o){return}},t.prototype.remove_annotations=function(){var t;for(t=0;t<this.length;)$("#annotation_"+t).remove(),t++},t.prototype.destroy_annotation=function(){return this.destroy=!0,this.remove_annotations()},t.prototype.update=function(){var t,e,o,n,a,s,r,l,p;for(n=0,a=this.panoid;n<this.length;)e="#annotation_"+n,l=$(e),t=this.annotation_angles[a][n][0],r=THREE.Math.degToRad(t),p=new THREE.Vector3(30*Math.cos(r),-10,30*Math.sin(r)),p.x+=13*Math.cos(r),p.z+=13*Math.sin(r),p=p.project(i.camera),o=$("#"+DirectPano.pano_div_id),s={x:(p.x+1)/2*o.width(),y:-(p.y-1)/2*o.height()},l&&(p.x>1||p.x<-1||p.y>1||p.y<-1||p.z>1||p.z<-1?"none"!==$(e).css("display")&&($(e).removeAttr("style"),$(e).css({display:"none"})):$(e).css({display:"block",left:"-10px",top:"0px",transform:"translate3d("+s.x+"px,"+s.y+"px,0px)",position:"absolute"})),n++;this.destroy||requestAnimationFrame(this.update.bind(this))},t}(),i.annotation=e,t.exports=i}).call(this)},function(t,e,o){(function(){var e,n;n=o(5),e=function(){function t(t){this.panoid=void 0,this.hotspot_angles=t,this.destroy=!1}return t.prototype.load_texture=function(){var t,e,o;return o=new THREE.Texture(window.texture_placeholder),e=new THREE.MeshBasicMaterial({map:o,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),t=new Image,t.onload=function(){return t.onload=null,o.image=this,o.needsUpdate=!0},t.src="../test/images/logo.png",e},t.prototype.add_hotspot=function(e,o,i,a){var s,r,l,p,h,c,d,u;r=new THREE.PlaneBufferGeometry(10,10,10),l=this.load_texture(),t=new THREE.Mesh(r,l),h=THREE.Math.degToRad(e),t.position.x=o*Math.cos(h),t.position.y=-50,t.position.z=o*Math.sin(h),u=new THREE.Vector3(-t.position.x,400,-t.position.z),t.lookAt(u),r=new THREE.PlaneBufferGeometry(1,1,1),p=this.panoid,d=DirectPano.hotspot_text[this.hotspot_angles[p][i][0]],t.panoid=this.hotspot_angles[p][i][0],t.deg_angle=e,s=document.getElementById(DirectPano.pano_div_id),c=document.createElement("div"),c.setAttribute("id","hotspot_"+this.hotspot_angles[p][i][0]),c.innerHTML=d,s.appendChild(c),t.hotspot_id=i,t.name="hotspot",n.scene.add(t),a.resolve()},t.prototype.add_hotspots=function(t){var e,o,n;for(this.panoid=t,n=this.hotspot_angles[t].length,e=[],o=0;n>o;)e[o]=$.Deferred(),o++;for(o=0;n>o;){if(this.destroy)return void this.remove_hotspots();this.add_hotspot(this.hotspot_angles[t][o][1],this.hotspot_angles[t][o][2],o,e[o]),o++}return $.when.apply($,e).done(function(){}).promise()},t.prototype.remove_hotspots=function(){var t,e,o,i;for(e=n.scene.children.length,i=0,t=0;e>t;)o=n.scene.children[i],"hotspot"===o.name?(o.geometry.dispose(),o.material.dispose(),n.scene.remove(o),$("#hotspot_"+o.panoid).remove()):i+=1,t++},t.prototype.front_nearest_hotspot=function(t){var e,o,i,a,s,r,l;for(r=this.hotspot_angles[t].length,s=-1,a=void 0,e=!1,o=0;r>o;)l=this.hotspot_angles[t][o][1],i=(n.Config.lon+360)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(e===!1||Math.abs(l-i)<Math.abs(a-i))&&(a=l,s=o,e=!0),o++;return s},t.prototype.back_nearest_hotspot=function(t){var e,o,i,a,s,r,l;for(r=this.hotspot_angles[t].length,s=-1,a=void 0,e=!1,o=0;r>o;)l=this.hotspot_angles[t][o][1],i=(n.Config.lon+360+180)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(e===!1||Math.abs(l-i)<Math.abs(a-i))&&(a=l,s=o,e=!0),o++;return s},t.prototype.destroy_hotspot=function(){return this.destroy=!0,this.remove_hotspots()},t.prototype.update=function(){var t,e,o,i,a,s,r,l;for(o=n.scene.children.length,e=0;o>e;)i=n.scene.children[e],"hotspot"===i.name&&(r=document.getElementById("hotspot_"+i.panoid),l=i.position.clone(),s=THREE.Math.degToRad(i.deg_angle+5),l.x+=13*Math.cos(s),l.z+=13*Math.sin(s),l=l.project(n.camera),t=document.getElementById("container"),a={x:(l.x+1)/2*t.offsetWidth,y:-(l.y-1)/2*t.offsetHeight},r&&(l.x>1||l.x<-1||l.y>1||l.y<-1||l.z>1||l.z<-1?"none"!==$("#hotspot_"+i.panoid).css("display")&&($("#hotspot_"+i.panoid).removeAttr("style"),$("#hotspot_"+i.panoid).css({display:"none"})):$("#hotspot_"+i.panoid).css({display:"block",left:"-10px",top:"0px",transform:"translate3d("+a.x+"px,"+a.y+"px,0px)","text-align":"left",color:"Yellow",position:"absolute","margin-left":"-20px"}))),e++;this.destroy||requestAnimationFrame(this.update.bind(this))},t}(),n.hotspot=e,t.exports=n}).call(this)},function(t,e,o){(function(){var e,n;n=o(6),e=function(){function t(t,e){this.pano_id=t,this.is_blur=e,this.name="panorama",this.destroy=!1}return t.prototype.create_pano=function(t,e){var o,i,a;for(a=[],i=0;6>i;)a.push(this.load_texture(t+n.Config.img_name[i]+".jpg",i)),i++;for(o=n.Config.webgl?new THREE.BoxGeometry(300,300,300,7,7,7):new THREE.BoxGeometry(300,300,300,20,20,20),this.mesh=new THREE.Mesh(o,new THREE.MeshFaceMaterial(a)),this.mesh.scale.x=-1,i=0;6>i;)this.mesh.material.materials[i].transparent=!0,this.mesh.material.materials[i].opacity=e,i++;n.scene.add(this.mesh)},t.prototype.destroy_pano=function(){var t;for(this.destroy=!0,n.scene.remove(this.mesh),t=0;6>t;)this.mesh.material.materials[t].map.dispose(),this.mesh.material.materials[t].dispose(),t++;return this.mesh.geometry.dispose()},t.prototype.load_texture=function(t,e){var o,i,a,s;return s=new THREE.Texture(n.texture_placeholder),i=new THREE.MeshBasicMaterial({map:s,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),a=this.pano_id,o=new Image,o.onload=function(){o.onload=null,s.image=this,s.needsUpdate=!0,n.clear_images[a][e]=o},o.src=t,i},t.prototype.get_texture=function(t,e,o,i){var a,s,r;return a=!1,r=new THREE.Texture(n.texture_placeholder),t=this.pano_id,n.clear_images[t][i]?(a=!0,r.image=n.clear_images[t][i],r.needsUpdate=!0,o.resolve(),r):this.is_blur===!0&&n.blur_images[t][i]?(a=!0,r.image=n.blur_images[t][i],r.needsUpdate=!0,o.resolve(),r):(s=new Image,s.onload=function(){r.image=this,r.needsUpdate=!0,o.resolve()},s.src=e,r)},t}(),n.Pano=e,t.exports=n}).call(this)},function(t,e,o){(function(){var e,n;n=o(7),e=function(){function t(){this.destroy=!1,this.animate()}return t.prototype.animate=function(){this.destroy||(requestAnimationFrame(this.animate.bind(this)),this.update())},t.prototype.update=function(){var t,e,o,i;n.Config.isUserInteracting===!1&&n.Config.autoplay===!0?n.Config.lon+=.2:n.Config.isUserInteracting===!1&&(t=Date.now()-n.Config.stop_time,t>2e3&&(n.Config.autoplay=!0,(o=function(e,i){return n.Config.isUserInteracting!==!0?(t=Date.now()-e,1e3>t?(n.Config.lat=i-i*t/1e3,requestAnimationFrame(function(){o(e,i)})):void(n.Config.lat=0)):void 0})(Date.now(),n.Config.lat))),n.Config.lon=(n.Config.lon+360)%360,n.Config.lat=Math.max(-35,Math.min(35,n.Config.lat)),e=THREE.Math.degToRad(90-n.Config.lat),i=THREE.Math.degToRad(n.Config.lon),n.camera.target.x=500*Math.sin(e)*Math.cos(i),n.camera.target.y=500*Math.cos(e),n.camera.target.z=500*Math.sin(e)*Math.sin(i),n.camera.lookAt(n.camera.target),n.renderer.render(n.scene,n.camera)},t}(),n.animation=e,t.exports=n}).call(this)},function(t,e){(function(){var e,o,n,i,a,s,r,l,p,h,c,d,u,m,_;u={},i=void 0,m=void 0,d=void 0,_=void 0,c=new THREE.Raycaster,n={},a={},o=void 0,e={img_name:["r","l","u","d","f","b"],isUserInteracting:!1,lon:0,lat:0,stop_time:void 0,autoplay:!0,webgl:!0},p=function(){var t,e;t=document.getElementById(DirectPano.pano_div_id),t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px",d.setSize(window.innerWidth,window.innerHeight),e=document.getElementById(DirectPano.image_div_id),e.style.visibility="hidden",i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix()},l=function(){var t,e;t=document.getElementById(DirectPano.pano_div_id),t.style.width=DirectPano.initial_width+"px",t.style.height=DirectPano.initial_height+"px",d.setSize(t.offsetWidth,t.offsetHeight),e=document.getElementById(DirectPano.image_div_id),e.style.visibility="visible",i.aspect=t.offsetWidth/t.offsetHeight,i.updateProjectionMatrix()},r=function(){var t,o;try{return t=document.createElement("canvas"),!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(n){return o=n,e.webgl=!1,!1}},h=function(){var t;t=document.getElementById(DirectPano.pano_div_id),m=new THREE.Scene,_=document.createElement("canvas"),_.width=128,_.height=128,d=r()?new THREE.WebGLRenderer:new THREE.CanvasRenderer,d.setPixelRatio(window.devicePixelRatio),t.appendChild(d.domElement),d.setSize(t.offsetWidth,t.offsetHeight),i=new THREE.PerspectiveCamera(65,t.offsetWidth/t.offsetHeight,1,1100),i.target=new THREE.Vector3(0,0,0),$("#"+DirectPano.image_div_id).click(function(){p()})},s=function(t){var o,i,s,r,l;for(u.Hotspot=void 0,o=0,s=a.length;s>o;o++)l=a[o],a[l]=null;for(i=0,r=n.length;r>i;i++)l=n[i],n[l]=null;a={},n={},e.lon=0,e.lat=0,e.stop_time=void 0,e.autoplay=!0},h(),u.destroy=s,u.Config=e,u.camera=i,u.scene=m,u.renderer=d,u.blur_images=n,u.clear_images=a,u.texture_placeholder=_,u.raycaster=c,u.escape_fullscreen=l,t.exports=u}).call(this)}]);
