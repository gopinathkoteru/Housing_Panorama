!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(){var e;e=n(1),e.Hotspot.init(DirectPano.hotspots_angle),e.Transition.init(DirectPano.pano_path),e.Hotspot.add_hotspots(0)}).call(this)},function(e,t,n){(function(){var t,o,a,i,r,s,c,l,p,u,m,d,h,_;h=n(2),r=void 0,s=void 0,i=void 0,a=void 0,t=7,o=2,_=function(e){var t,n,o,a;switch(o=e.changedTouches,t=o[0],a="",e.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}n=document.createEvent("MouseEvent"),n.initMouseEvent(a,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n),e.preventDefault()},p=function(e){var t,n,o;e.preventDefault(),h.Config.isUserInteracting=!0,r=e.clientX,s=e.clientY,i=h.Config.lon,a=h.Config.lat,o=new THREE.Vector3,t=document.getElementById("container"),o.set(e.clientX/t.offsetWidth*2-1,2*-(e.clientY/t.offsetHeight)+1,.5),o.unproject(h.camera),h.raycaster.set(h.camera.position,o.sub(h.camera.position).normalize()),n=h.raycaster.intersectObjects(h.scene.children,!0),n.length>0&&"hotspot"===n[0].object.name&&h.Transition.start(n[0].object.hotspot_id)},u=function(e){var t;h.Config.isUserInteracting===!0&&(t=.3,h.Config.lon=(r-e.clientX)*t+i,h.Config.lat=(e.clientY-s)*t+a)},m=function(e){h.Config.isUserInteracting=!1,h.Config.stop_time=Date.now(),h.Config.autoplay=!1},d=function(e){e.wheelDeltaY?h.camera.fov-=.05*e.wheelDeltaY:e.wheelDelta?h.camera.fov-=.05*e.wheelDelta:e.detail&&(h.camera.fov+=1*e.detail),h.camera.fov=Math.max(60,Math.min(90,h.camera.fov)),h.camera.updateProjectionMatrix()},c=function(e){var n,a;a=void 0,e||(e=window.event),h.Config.isUserInteracting=!0,n=e.keyCode,37===n?h.Config.lon-=o:39===n?h.Config.lon+=o:38===n?h.Transition.moving===!1&&(a=h.Hotspot.front_nearest_hotspot(h.Transition.current_pano),-1!==a&&h.Transition.start(a)):40===n&&h.Transition.moving===!1&&(a=h.Hotspot.back_nearest_hotspot(h.Transition.current_pano),-1!==a&&h.Transition.start(a)),h.Config.isUserInteracting===!0&&t>o&&(o+=1)},l=function(e){h.Config.isUserInteracting=!1,o=2,h.Config.stop_time=Date.now(),h.Config.autoplay=!1},$("#"+DirectPano.pano_div_id).on({click:function(e){document.getElementById(DirectPano.pano_div_id).focus()},mousedown:function(e){p(e)},mousemove:function(e){u(e)},mouseup:function(e){m(e)},mousewheel:function(e){d(e.originalEvent)},DOMMouseScroll:function(e){d(e.originalEvent)},touchstart:function(e){_(e)},touchmove:function(e){_(e)},touchend:function(e){_(e)},keydown:function(e){c(e)},keyup:function(e){l(e)}}),e.exports=h}).call(this)},function(e,t,n){(function(){var t,o;o=n(3),t={pano:"",current_pano:0,pano_num:0,moving:!1},t.init=function(e){var n,a;t.path=e,o.clear_images[t.current_pano]=[],e=e+(t.current_pano+1)+"/mobile_",t.blur_pano=new o.Pano(0,!0),n=new o.Pano(0,!1),a=new o.Pano(0,!1),t.blur_pano.create_pano(e,0),n.create_pano(e,1),a.create_pano(e,0),t.clear_pano=[n,a],t.preload_images()},t.save_clear_images=function(){var e,n;if(!o.clear_images[t.current_pano])for(n=t.path+(t.current_pano+1)+"/mobile_",o.clear_images[t.current_pano]=[],e=0;6>e;)!function(){var a,i,r;r=new THREE.Texture(o.texture_placeholder),i=e,a=new Image,a.onload=function(){r.image=this,r.needsUpdate=!0,o.clear_images[t.current_pano][i]||(o.clear_images[t.current_pano][i]=a)},a.src=n+o.Config.img_name[e]+".jpg"}(),e++},t.preload_images=function(){var e;for(e=0;e<o.Hotspot.hotspot_angles[t.current_pano].length;)!function(){var n,a,i;if(a=o.Hotspot.hotspot_angles[t.current_pano][e][0],!o.blur_images[a])for(o.blur_images[a]=[],i=t.path+"blur_"+(a+1)+"/mobile_",n=0;6>n;)!function(){var e,t,r;r=new THREE.Texture(o.texture_placeholder),t=n,e=new Image,e.onload=function(){r.image=this,r.needsUpdate=!0,o.blur_images[a][t]||(o.blur_images[a][t]=e)},e.src=i+o.Config.img_name[n]+".jpg"}(),n++}(),e++},t.complete=function(e){t.moving=!1,o.Hotspot.add_hotspots(e)},t.start=function(e){var n,a,i,r,s,c,l,p,u,m;u=o.Hotspot.hotspot_angles[t.current_pano][e][0],s=o.Hotspot.hotspot_angles[t.current_pano][e][1],i=o.Hotspot.hotspot_angles[t.current_pano][e][2],r=function(){var e;for(e=s-o.Config.lon;e>180;)e-=360;for(;-180>e;)e+=360;return e>50?e=(e-180)%360:-50>e&&(e=(e+180)%360),e+=o.Config.lon},c=function(){var e,n,a;for(a=t.path+"blur_"+(u+1)+"/mobile_",e=[],n=0;6>n;)e[n]=$.Deferred(),n++;for(t.blur_pano.pano_id=u,n=0;6>n;)t.blur_pano.mesh.material.materials[n].map.dispose(),t.blur_pano.mesh.material.materials[n].map=t.blur_pano.get_texture(t.current_pano,a+o.Config.img_name[n]+".jpg",e[n],n),t.blur_pano.mesh.material.materials[n].opacity=0,n++;return t.blur_pano.mesh.position.x=i*Math.cos(THREE.Math.degToRad(s)),t.blur_pano.mesh.position.z=i*Math.sin(THREE.Math.degToRad(s)),$.when(e[0],e[1],e[2],e[3],e[4],e[5]).done(function(){}).promise()},l=function(){var e,n,a;for(a=t.path+(u+1)+"/mobile_",e=[],n=0;6>n;)e[n]=$.Deferred(),n++;for(t.clear_pano[t.pano_num].pano_id=u,n=0;6>n;)t.clear_pano[t.pano_num].mesh.material.materials[n].map.dispose(),t.clear_pano[t.pano_num].mesh.material.materials[n].map=t.clear_pano[t.pano_num].get_texture(t.current_pano,a+o.Config.img_name[n]+".jpg",e[n],n),t.clear_pano[t.pano_num].mesh.material.materials[n].opacity=0,n++;return $.when(e[0],e[1],e[2],e[3],e[4],e[5]).done(function(){}).promise()},p=function(){var e,n,r,c;for(c=.4,TweenLite.to(o.Config,c,{lon:m,lat:0,ease:Power0.easeOut}),r=2,e=.3,TweenLite.to(t.blur_pano.mesh.position,r,{x:0,z:0,delay:e,ease:Expo.easeOut}),n=0;6>n;)TweenLite.to(t.clear_pano[t.pano_num].mesh.material.materials[n],r,{opacity:0,delay:e,ease:Expo.easeOut}),TweenLite.to(t.blur_pano.mesh.material.materials[n],r,{opacity:1,delay:e,ease:Expo.easeOut}),n++;TweenLite.to(t.clear_pano[t.pano_num].mesh.position,r,{x:-1*i*Math.cos(THREE.Math.degToRad(s)),z:-1*i*Math.sin(THREE.Math.degToRad(s)),delay:e,ease:Expo.easeOut,onComplete:a})},a=function(){var e;for(t.clear_pano[t.pano_num].mesh.position.x=0,t.clear_pano[t.pano_num].mesh.position.z=0,e=0;6>e;)t.clear_pano[t.pano_num].mesh.material.materials[e].opacity=0,t.clear_pano[t.pano_num].mesh.material.materials[e].map.dispose(),t.blur_pano.mesh.material.materials[e].opacity=1,e++;t.pano_num=(t.pano_num+1)%2,l().done(function(){n(),t.preload_images()})},n=function(){var e,n;for(n=.5,e=0;6>e;)TweenLite.to(t.blur_pano.mesh.material.materials[e],n,{opacity:0,ease:Power0.easeOut}),e++;for(e=0;6>e;)5===e?TweenLite.to(t.clear_pano[t.pano_num].mesh.material.materials[e],n,{opacity:1,ease:Power0.easeOut,onComplete:t.complete,onCompleteParams:[u]}):TweenLite.to(t.clear_pano[t.pano_num].mesh.material.materials[e],n,{opacity:1,ease:Power0.easeOut}),e++},t.moving=!0,t.current_pano=u,t.save_clear_images(),m=r(),o.Hotspot.remove_hotspots(),c().done(function(){p()})},o.Transition=t,e.exports=o}).call(this)},function(e,t,n){(function(){var t,o;o=n(4),t={panoid:void 0,hotspot_angles:void 0},t.init=function(e){return t.hotspot_angles=e},t.load_texture=function(){var e,t,n;return n=new THREE.Texture(window.texture_placeholder),t=new THREE.MeshBasicMaterial({map:n,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),e=new Image,e.onload=function(){return n.image=this,n.needsUpdate=!0},e.src="../test/images/logo.png",t},t.add_hotspot=function(e,n,a){var i,r,s,c,l;i=new THREE.PlaneBufferGeometry(10,10,10),s=t.load_texture(),r=new THREE.Mesh(i,s),c=THREE.Math.degToRad(e),r.position.x=60*Math.cos(c),r.position.y=-10,r.position.z=60*Math.sin(c),l=new THREE.Vector3(-r.position.x,400,-r.position.z),r.lookAt(l),r.hotspot_id=a,r.name="hotspot",o.scene.add(r)},t.add_hotspots=function(e){var n,o;for(t.panoid=e,o=t.hotspot_angles[e].length,n=0;o>n;)t.add_hotspot(t.hotspot_angles[e][n][1],t.hotspot_angles[e][n][2],n),n++},t.remove_hotspots=function(){var e,t,n,a;for(t=o.scene.children.length,a=0,e=0;t>e;)n=o.scene.children[a],"hotspot"===n.name?(n.geometry.dispose(),n.material.dispose(),o.scene.remove(n)):a+=1,e++},t.front_nearest_hotspot=function(e){var n,a,i,r,s,c,l;for(c=t.hotspot_angles[e].length,s=-1,r=void 0,n=!1,a=0;c>a;)l=t.hotspot_angles[e][a][1],i=(o.Config.lon+360)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(n===!1||Math.abs(l-i)<Math.abs(r-i))&&(r=l,s=a,n=!0),a++;return s},t.back_nearest_hotspot=function(e){var n,a,i,r,s,c,l;for(c=t.hotspot_angles[e].length,s=-1,r=void 0,n=!1,a=0;c>a;)l=t.hotspot_angles[e][a][1],i=(o.Config.lon+360+180)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(n===!1||Math.abs(l-i)<Math.abs(r-i))&&(r=l,s=a,n=!0),a++;return s},o.Hotspot=t,e.exports=o}).call(this)},function(e,t,n){(function(){var t;t=n(5),t.Pano=function(){function e(e,t){this.pano_id=e,this.is_blur=t,this.name="panorama"}return e.prototype.create_pano=function(e,n){var o,a,i;for(i=[],a=0;6>a;)i.push(this.load_texture(e+t.Config.img_name[a]+".jpg",a)),a++;for(o=t.Config.webgl?new THREE.BoxGeometry(300,300,300,7,7,7):new THREE.BoxGeometry(300,300,300,20,20,20),this.mesh=new THREE.Mesh(o,new THREE.MeshFaceMaterial(i)),this.mesh.scale.x=-1,a=0;6>a;)this.mesh.material.materials[a].transparent=!0,this.mesh.material.materials[a].opacity=n,a++;t.scene.add(this.mesh)},e.prototype.load_texture=function(e,n){var o,a,i,r;return r=new THREE.Texture(t.texture_placeholder),a=new THREE.MeshBasicMaterial({map:r,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),i=this.pano_id,o=new Image,o.onload=function(){r.image=this,r.needsUpdate=!0,t.clear_images[i][n]||(t.clear_images[i][n]=o)},o.src=e,a},e.prototype.get_texture=function(e,n,o,a){var i,r,s,c;return i=!1,c=new THREE.Texture(t.texture_placeholder),s=this.pano_id,t.clear_images[e][a]?(i=!0,c.image=t.clear_images[e][a],c.needsUpdate=!0,o.resolve(),c):this.is_blur===!0&&t.blur_images[e][a]?(i=!0,c.image=t.blur_images[e][a],c.needsUpdate=!0,o.resolve(),c):(r=new Image,r.onload=function(){c.image=this,c.needsUpdate=!0,o.resolve()},r.src=n,c)},e}(),e.exports=t}).call(this)},function(e,t){(function(){var t,n,o,a,i,r,s,c,l,p,u,m,d,h,_;u={},a=void 0,d=void 0,p=void 0,h=void 0,l=new THREE.Raycaster,o={},i={},t={img_name:["r","l","u","d","f","b"],isUserInteracting:!1,lon:0,lat:0,stop_time:void 0,autoplay:!0,webgl:!0},s=function(){var e,t;e=document.getElementById(DirectPano.pano_div_id),e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",p.setSize(window.innerWidth,window.innerHeight),t=document.getElementById("fullscreen-image"),t.style.visibility="hidden",a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix()},r=function(){var e,n;try{return e=document.createElement("canvas"),!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(o){return n=o,t.webgl=!1,!1}},c=function(){var e;e=document.getElementById(DirectPano.pano_div_id),d=new THREE.Scene,h=document.createElement("canvas"),h.width=128,h.height=128,p=r()?new THREE.WebGLRenderer:new THREE.CanvasRenderer,p.setPixelRatio(window.devicePixelRatio),console.log(t.webgl),e.appendChild(p.domElement),p.setSize(e.offsetWidth,e.offsetHeight),a=new THREE.PerspectiveCamera(60,e.offsetWidth/e.offsetHeight,1,1100),a.target=new THREE.Vector3(0,0,0)},n=function(){requestAnimationFrame(n),_()},m=function(e,n){var o;t.isUserInteracting!==!0&&(o=Date.now()-e,1e3>o?(t.lat=n-n*o/1e3,requestAnimationFrame(function(){return m(e,n)})):t.lat=0)},_=function(){var e,n,o;t.isUserInteracting===!1&&t.autoplay===!0?t.lon+=.2:t.isUserInteracting===!1&&(e=Date.now()-t.stop_time,e>2e3&&(t.autoplay=!0,m(Date.now(),t.lat))),t.lon=(t.lon+360)%360,t.lat=Math.max(-35,Math.min(35,t.lat)),n=THREE.Math.degToRad(90-t.lat),o=THREE.Math.degToRad(t.lon),a.target.x=500*Math.sin(n)*Math.cos(o),a.target.y=500*Math.cos(n),a.target.z=500*Math.sin(n)*Math.sin(o),a.lookAt(a.target),p.render(d,a)},c(),n(),u.Config=t,u.camera=a,u.scene=d,u.renderer=p,u.blur_images=o,u.clear_images=i,u.texture_placeholder=h,u.raycaster=l,document.getElementById(DirectPano.image_div_id).onclick=function(){return s()},e.exports=u}).call(this)}]);
