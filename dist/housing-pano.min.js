!function(e){function t(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){(function(){var e,t;t=void 0,e=void 0,DirectPano.show_pano=function(){t=o(1),t.scene.children.length=0,e=new t.animation,e.animate(),t.add_listeners(),t.Hotspot=new t.hotspot(DirectPano.hotspots_angle),t.Transition=new t.transition(DirectPano.pano_path,DirectPano.hotspots_angle),t.Hotspot.add_hotspots(0)},DirectPano.remove_pano=function(){e.destroy=!0,e=null,t.Hotspot.destroy_hotspot(),t.Hotspot=null,t.Transition.destroy_transition(),t.Transition=null,t.remove_listeners(),t.destroy()}}).call(this)},function(e,t,o){(function(){var t,n,i,a,s,r,l,p,h,c,d,u,m,_,f,g;f=o(2),r=void 0,l=void 0,s=void 0,a=void 0,n=7,i=2,g=function(e){var t,o,n,i;switch(n=e.changedTouches,t=n[0],i="",e.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}o=document.createEvent("MouseEvent"),o.initMouseEvent(i,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()},c=function(e){var t,o,n;e.preventDefault(),f.Config.isUserInteracting=!0,r=e.clientX,l=e.clientY,s=f.Config.lon,a=f.Config.lat,n=new THREE.Vector3,t=document.getElementById("container"),n.set(e.clientX/t.offsetWidth*2-1,2*-(e.clientY/t.offsetHeight)+1,.5),n.unproject(f.camera),f.raycaster.set(f.camera.position,n.sub(f.camera.position).normalize()),o=f.raycaster.intersectObjects(f.scene.children,!0),o.length>0&&"hotspot"===o[0].object.name&&f.Transition.start(o[0].object.hotspot_id)},d=function(e){var t;f.Config.isUserInteracting===!0&&(t=.3,f.Config.lon=(r-e.clientX)*t+s,f.Config.lat=(e.clientY-l)*t+a)},u=function(e){f.Config.isUserInteracting=!1,f.Config.stop_time=Date.now(),f.Config.autoplay=!1},m=function(e){e.wheelDeltaY?f.camera.fov-=.05*e.wheelDeltaY:e.wheelDelta?f.camera.fov-=.05*e.wheelDelta:e.detail&&(f.camera.fov+=1*e.detail),f.camera.fov=Math.max(60,Math.min(90,f.camera.fov)),f.camera.updateProjectionMatrix()},p=function(e){var t,o,a;a=void 0,e||(e=window.event),f.Config.isUserInteracting=!0,o=e.keyCode,37===o?f.Config.lon-=i:39===o?f.Config.lon+=i:38===o?f.Transition.moving===!1&&(a=f.Hotspot.front_nearest_hotspot(f.Transition.current_pano),-1!==a&&f.Transition.start(a)):40===o?f.Transition.moving===!1&&(a=f.Hotspot.back_nearest_hotspot(f.Transition.current_pano),-1!==a&&f.Transition.start(a)):27===o&&(t=document.getElementById(DirectPano.pano_div_id),t.style.width===window.innerWidth+"px"&&(t.style.height=window.innerHeight+"px")&&f.escape_fullscreen()),f.Config.isUserInteracting===!0&&n>i&&(i+=1)},h=function(e){f.Config.isUserInteracting=!1,i=2,f.Config.stop_time=Date.now(),f.Config.autoplay=!1},t=function(){return $("#"+DirectPano.pano_div_id).on({click:function(e){document.getElementById(DirectPano.pano_div_id).focus()},mousedown:function(e){c(e)},mousemove:function(e){d(e)},mouseup:function(e){u(e)},mousewheel:function(e){m(e.originalEvent)},DOMMouseScroll:function(e){m(e.originalEvent)},touchstart:function(e){g(e.originalEvent)},touchmove:function(e){g(e.originalEvent)},touchend:function(e){g(e.originalEvent)},keydown:function(e){p(e)},keyup:function(e){h(e)}})},_=function(){$("#"+DirectPano.pano_div_id).off()},f.add_listeners=t,f.remove_listeners=_,e.exports=f}).call(this)},function(e,t,o){(function(){var t,n;t=o(3),n=function(){function e(e,o){var n,i;this.path=e,this.current_pano=0,this.pano_num=0,this.moving=!1,this.hotspot_angles=o,this.destroy=!1,t.clear_images={},t.blur_images={},t.clear_images[this.current_pano]=[],e=e+(this.current_pano+1)+"/mobile_",this.blur_pano=new t.Pano(0,!0),n=new t.Pano(0,!1),i=new t.Pano(0,!1),this.blur_pano.create_pano(e,0),n.create_pano(e,1),i.create_pano(e,0),this.clear_pano=[n,i],this.preload_images()}return e.prototype.save_clear_images=function(){var e,o,n;if(e=this.current_pano,n=this.path,!t.clear_images[e])for(n=n+(e+1)+"/mobile_",t.clear_images[e]=[],o=0;6>o;)!function(){var i,a,s;s=new THREE.Texture(t.texture_placeholder),a=o,i=new Image,i.onload=function(){s.image=this,s.needsUpdate=!0,t.clear_images[e][a]||(t.clear_images[e][a]=i)},i.src=n+t.Config.img_name[o]+".jpg"}(),o++},e.prototype.preload_images=function(){var e,o,n,i;for(n=0,e=this.current_pano,o=this.hotspot_angles,i=this.path;n<o[e].length;)!function(){var a,s,r;if(r=o[e][n][0],!t.blur_images[r])for(t.blur_images[r]=[],a=i+"blur_"+(r+1)+"/mobile_",s=0;6>s;)!function(){var e,o,n;n=new THREE.Texture(t.texture_placeholder),o=s,e=new Image,e.onload=function(){n.image=this,n.needsUpdate=!0,t.blur_images[r][o]||(t.blur_images[r][o]=e)},e.src=a+t.Config.img_name[s]+".jpg"}(),s++}(),n++},e.prototype.start=function(e){var o,n,i,a,s,r;o=this.current_pano,s=this.hotspot_angles[o][e][0],i=this.hotspot_angles[o][e][1],n=this.hotspot_angles[o][e][2],this.moving=!0,this.current_pano=s,this.save_clear_images(),r=this.find_rotation_angle(i),t.Hotspot.remove_hotspots(),a=this.old_pano_to_blur_pano.bind(this),this.preload_images(),this.load_blur_pano(n,i).done(function(){a(n,i,r)})},e.prototype.find_rotation_angle=function(e){var o;for(o=e-t.Config.lon;o>180;)o-=360;for(;-180>o;)o+=360;return o>50?o=(o-180)%360:-50>o&&(o=(o+180)%360),o+=t.Config.lon},e.prototype.load_blur_pano=function(e,o){var n,i,a;if(this.destroy)return $.when().done(function(){}).promise();for(a=this.path+"blur_"+(this.current_pano+1)+"/mobile_",n=[],i=0;6>i;)n[i]=$.Deferred(),i++;for(this.blur_pano.pano_id=this.current_pano,i=0;6>i;)this.blur_pano.mesh.material.materials[i].map.dispose(),this.blur_pano.mesh.material.materials[i].map=this.blur_pano.get_texture(this.pano_id,a+t.Config.img_name[i]+".jpg",n[i],i),this.blur_pano.mesh.material.materials[i].opacity=0,i++;return this.blur_pano.mesh.position.x=e*Math.cos(THREE.Math.degToRad(o)),this.blur_pano.mesh.position.z=e*Math.sin(THREE.Math.degToRad(o)),$.when.apply($,n).done(function(){}).promise()},e.prototype.load_clear_pano=function(){var e,o,n,i;if(this.destroy)return $.when().done(function(){}).promise();for(i=this.path+(this.current_pano+1)+"/mobile_",e=[],o=0;6>o;)e[o]=$.Deferred(),o++;for(n=this.pano_num,this.clear_pano[n].pano_id=this.current_pano,o=0;6>o;)this.clear_pano[n].mesh.material.materials[o].map.dispose(),this.clear_pano[n].mesh.material.materials[o].map=this.clear_pano[n].get_texture(this.pano_id,i+t.Config.img_name[o]+".jpg",e[o],o),this.clear_pano[n].mesh.material.materials[o].opacity=0,o++;return $.when.apply($,e).done(function(){}).promise()},e.prototype.old_pano_to_blur_pano=function(e,o,n){var i,a,s,r,l,p,h;if(!this.destroy){for(h=.4,TweenLite.to(t.Config,h,{lon:n,lat:0,ease:Power0.easeOut}),p=2,s=.3,i=this.blur_pano,a=this.clear_pano,l=this.pano_num,TweenLite.to(i.mesh.position,p,{x:0,z:0,delay:s,ease:Expo.easeOut}),r=0;6>r;)TweenLite.to(a[l].mesh.material.materials[r],p,{opacity:0,delay:s,ease:Expo.easeOut}),TweenLite.to(i.mesh.material.materials[r],p,{opacity:1,delay:s,ease:Expo.easeOut}),r++;TweenLite.to(a[l].mesh.position,p,{x:-1*e*Math.cos(THREE.Math.degToRad(o)),z:-1*e*Math.sin(THREE.Math.degToRad(o)),delay:s,ease:Expo.easeOut,onComplete:this.check_new_pano_load.bind(this)})}},e.prototype.check_new_pano_load=function(){var e,t,o;if(!this.destroy){for(o=this.pano_num,this.clear_pano[o].mesh.position.x=0,this.clear_pano[o].mesh.position.z=0,t=0;6>t;)this.clear_pano[o].mesh.material.materials[t].opacity=0,this.clear_pano[o].mesh.material.materials[t].map.dispose(),this.blur_pano.mesh.material.materials[t].opacity=1,t++;this.pano_num=(this.pano_num+1)%2,e=this.blur_pano_to_new_pano.bind(this),this.load_clear_pano().done(function(){e()})}},e.prototype.blur_pano_to_new_pano=function(){var e,t,o,n,i;if(!this.destroy){for(e=this.blur_pano,t=this.clear_pano,n=this.pano_num,i=.5,o=0;6>o;)TweenLite.to(e.mesh.material.materials[o],i,{opacity:0,ease:Power0.easeOut}),o++;for(o=0;6>o;)5===o?TweenLite.to(t[n].mesh.material.materials[o],i,{opacity:1,ease:Power0.easeOut,onComplete:this.complete.bind(this)}):TweenLite.to(t[n].mesh.material.materials[o],i,{opacity:1,ease:Power0.easeOut}),o++}},e.prototype.complete=function(){var e;this.destroy||(e=this.current_pano,t.Hotspot.add_hotspots(e).done(function(){this.moving=!1}))},e.prototype.destroy_transition=function(){var e,t;this.destroy=!0,e=this.blur_pano,t=this.clear_pano,TweenLite.killTweensOf(e),TweenLite.killTweensOf(t),this.blur_pano.destroy_pano(),this.clear_pano[0].destroy_pano(),this.clear_pano[1].destroy_pano(),this.blur_pano=null,this.clear_pano[0]=null,this.clear_pano[1]=null,this.clear_pano=null},e}(),t.transition=n,e.exports=t}).call(this)},function(e,t,o){(function(){var t,n;n=o(4),t=function(){function e(e){this.panoid=void 0,this.hotspot_angles=e,this.destroy=!1}return e.prototype.load_texture=function(){var e,t,o;return o=new THREE.Texture(window.texture_placeholder),t=new THREE.MeshBasicMaterial({map:o,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),e=new Image,e.onload=function(){return o.image=this,o.needsUpdate=!0},e.src="../test/images/logo.png",t},e.prototype.add_hotspot=function(t,o,i,a){var s,r,l,p,h,c,d;s=new THREE.PlaneBufferGeometry(10,10,10),r=this.load_texture(),e=new THREE.Mesh(s,r),l=THREE.Math.degToRad(t),e.position.x=o*Math.cos(l),e.position.y=-50,e.position.z=o*Math.sin(l),c=new THREE.Vector3(-e.position.x,400,-e.position.z),e.lookAt(c),s=new THREE.PlaneBufferGeometry(1,1,1),h=DirectPano.hotspot_text[this.hotspot_angles[n.Transition.current_pano][i][0]],s=new THREE.TextGeometry(h,{size:10,height:1,curveSegments:10,weight:"normal",style:"normal",material:0,extrudeMaterial:1}),r=new THREE.MeshBasicMaterial({color:16776960}),p=new THREE.Mesh(s,r),p.scale.x=.2,p.scale.y=.2,p.scale.z=.2,l=THREE.Math.degToRad(t-30),p.position.x=e.position.x+7*Math.cos(l),p.position.y=e.position.y,p.position.z=e.position.z+7*Math.sin(l),p.name="hotspot",d=new THREE.Vector3(-e.position.x,400,-e.position.z),p.lookAt(d),n.scene.add(p),e.hotspot_id=i,e.name="hotspot",n.scene.add(e),a.resolve()},e.prototype.add_hotspots=function(e){var t,o,n;for(this.panoid=e,n=this.hotspot_angles[e].length,t=[],o=0;n>o;)t[o]=$.Deferred(),o++;for(o=0;n>o;){if(this.destroy)return void this.remove_hotspots();this.add_hotspot(this.hotspot_angles[e][o][1],this.hotspot_angles[e][o][2],o,t[o]),o++}return $.when.apply($,t).done(function(){}).promise()},e.prototype.remove_hotspots=function(){var e,t,o,i;for(t=n.scene.children.length,i=0,e=0;t>e;)o=n.scene.children[i],"hotspot"===o.name?(o.geometry.dispose(),o.material.dispose(),n.scene.remove(o)):i+=1,e++},e.prototype.front_nearest_hotspot=function(e){var t,o,i,a,s,r,l;for(r=this.hotspot_angles[e].length,s=-1,a=void 0,t=!1,o=0;r>o;)l=this.hotspot_angles[e][o][1],i=(n.Config.lon+360)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(t===!1||Math.abs(l-i)<Math.abs(a-i))&&(a=l,s=o,t=!0),o++;return s},e.prototype.back_nearest_hotspot=function(e){var t,o,i,a,s,r,l;for(r=this.hotspot_angles[e].length,s=-1,a=void 0,t=!1,o=0;r>o;)l=this.hotspot_angles[e][o][1],i=(n.Config.lon+360+180)%360,0>l&&(l+=360),(i>=45&&315>=i&&(i+45)%360>=l&&l>=(i-45+360)%360||45>=i&&l>=0&&i+45>=l||45>=i&&l>=(i-45+360)%360&&360>=l||i>=315&&l>=i-45&&360>=l||i>=315&&l>=0&&(i+45)%360>=l)&&(t===!1||Math.abs(l-i)<Math.abs(a-i))&&(a=l,s=o,t=!0),o++;return s},e.prototype.destroy_hotspot=function(){return this.destroy=!0,this.remove_hotspots()},e}(),n.hotspot=t,e.exports=n}).call(this)},function(e,t,o){(function(){var t,n;n=o(5),t=function(){function e(e,t){this.pano_id=e,this.is_blur=t,this.name="panorama",this.destroy=!1}return e.prototype.create_pano=function(e,t){var o,i,a;for(a=[],i=0;6>i;)a.push(this.load_texture(e+n.Config.img_name[i]+".jpg",i)),i++;for(o=n.Config.webgl?new THREE.BoxGeometry(300,300,300,7,7,7):new THREE.BoxGeometry(300,300,300,20,20,20),this.mesh=new THREE.Mesh(o,new THREE.MeshFaceMaterial(a)),this.mesh.scale.x=-1,i=0;6>i;)this.mesh.material.materials[i].transparent=!0,this.mesh.material.materials[i].opacity=t,i++;n.scene.add(this.mesh)},e.prototype.destroy_pano=function(){var e;for(this.destroy=!0,n.scene.remove(this.mesh),e=0;6>e;)this.mesh.material.materials[e].map.dispose(),this.mesh.material.materials[e].dispose(),e++;return this.mesh.geometry.dispose()},e.prototype.load_texture=function(e,t){var o,i,a,s;return s=new THREE.Texture(n.texture_placeholder),i=new THREE.MeshBasicMaterial({map:s,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),a=this.pano_id,o=new Image,o.onload=function(){s.image=this,s.needsUpdate=!0,n.clear_images[a][t]||(n.clear_images[a][t]=o)},o.src=e,i},e.prototype.get_texture=function(e,t,o,i){var a,s,r;return a=!1,r=new THREE.Texture(n.texture_placeholder),e=this.pano_id,n.clear_images[e][i]?(a=!0,r.image=n.clear_images[e][i],r.needsUpdate=!0,o.resolve(),r):this.is_blur===!0&&n.blur_images[e][i]?(a=!0,r.image=n.blur_images[e][i],r.needsUpdate=!0,o.resolve(),r):(s=new Image,s.onload=function(){r.image=this,r.needsUpdate=!0,o.resolve()},s.src=t,r)},e}(),n.Pano=t,e.exports=n}).call(this)},function(e,t,o){(function(){var t,n;n=o(6),t=function(){function e(){this.destroy=!1}return e.prototype.animate=function(){this.destroy||(requestAnimationFrame(this.animate.bind(this)),this.update())},e.prototype.update=function(){var e,t,o,i;n.Config.isUserInteracting===!1&&n.Config.autoplay===!0?n.Config.lon+=.2:n.Config.isUserInteracting===!1&&(e=Date.now()-n.Config.stop_time,e>2e3&&(n.Config.autoplay=!0,(o=function(t,i){return n.Config.isUserInteracting!==!0?(e=Date.now()-t,1e3>e?(n.Config.lat=i-i*e/1e3,requestAnimationFrame(function(){o(t,i)})):void(n.Config.lat=0)):void 0})(Date.now(),n.Config.lat))),n.Config.lon=(n.Config.lon+360)%360,n.Config.lat=Math.max(-35,Math.min(35,n.Config.lat)),t=THREE.Math.degToRad(90-n.Config.lat),i=THREE.Math.degToRad(n.Config.lon),n.camera.target.x=500*Math.sin(t)*Math.cos(i),n.camera.target.y=500*Math.cos(t),n.camera.target.z=500*Math.sin(t)*Math.sin(i),n.camera.lookAt(n.camera.target),n.renderer.render(n.scene,n.camera)},e}(),n.animation=t,e.exports=n}).call(this)},function(e,t){(function(){var t,o,n,i,a,s,r,l,p,h,c,d,u,m,_;u={},i=void 0,m=void 0,d=void 0,_=void 0,c=new THREE.Raycaster,n={},a={},o=void 0,t={img_name:["r","l","u","d","f","b"],isUserInteracting:!1,lon:0,lat:0,stop_time:void 0,autoplay:!0,webgl:!0},p=function(){var e,t;e=document.getElementById(DirectPano.pano_div_id),e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",d.setSize(window.innerWidth,window.innerHeight),t=document.getElementById(DirectPano.image_div_id),t.style.visibility="hidden",i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix()},l=function(){var e,t;e=document.getElementById(DirectPano.pano_div_id),e.style.width=DirectPano.initial_width+"px",e.style.height=DirectPano.initial_height+"px",d.setSize(e.offsetWidth,e.offsetHeight),t=document.getElementById(DirectPano.image_div_id),t.style.visibility="visible",i.aspect=e.offsetWidth/e.offsetHeight,i.updateProjectionMatrix()},r=function(){var e,o;try{return e=document.createElement("canvas"),!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(n){return o=n,t.webgl=!1,!1}},h=function(){var e;e=document.getElementById(DirectPano.pano_div_id),m=new THREE.Scene,_=document.createElement("canvas"),_.width=128,_.height=128,d=r()?new THREE.WebGLRenderer:new THREE.CanvasRenderer,d.setPixelRatio(window.devicePixelRatio),e.appendChild(d.domElement),d.setSize(e.offsetWidth,e.offsetHeight),i=new THREE.PerspectiveCamera(65,e.offsetWidth/e.offsetHeight,1,1100),i.target=new THREE.Vector3(0,0,0)},s=function(e){var o,i,s,r,l,p,h,c;for(u.Hotspot=void 0,i=0,l=a.length;l>i;i++){for(c=a[i],o=s=0;6>=s;o=++s)delete a[c][o];delete a[c]}for(r=0,p=n.length;p>r;r++){for(c=n[r],o=h=0;6>=h;o=++h)delete n[c][o];delete n[c]}t.lon=0,t.lat=0,t.stop_time=void 0,t.autoplay=!0},h(),u.destroy=s,u.Config=t,u.camera=i,u.scene=m,u.renderer=d,u.blur_images=n,u.clear_images=a,u.texture_placeholder=_,u.raycaster=c,u.escape_fullscreen=l,document.getElementById(DirectPano.image_div_id).onclick=function(){return p()},e.exports=u}).call(this)}]);
